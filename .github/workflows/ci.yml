name: CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

concurrency:
  group: ci-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build_test:
    name: Platform CI Validation
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout repository
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Setup Node.js (tooling only, not runtime)
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      # 3. Validate repository structure
      - name: Validate VulcanPaaS structure
        run: |
          echo "Validating VulcanPaaS repository structure..."
          echo "Root contents:"
          ls -la

      # 4. Lint PowerShell scripts (basic validation)
      - name: Validate PowerShell scripts
        shell: pwsh
        run: |
          echo "Checking PowerShell scripts..."
          Get-ChildItem -Recurse -Filter *.ps1 | ForEach-Object {
            Write-Host "Checking $($_.FullName)"
          }

      # 5. (Optional) Docker availability check
      - name: Check Docker availability
        run: |
          docker --version || echo "Docker not available in CI runner"

      # 6. CI completion marker
      - name: CI completed
        run: echo "VulcanPaaS CI pipeline completed successfully"
